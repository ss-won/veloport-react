# veloportì™€ í•¨ê»˜í•˜ëŠ” ëª¨ë˜ ë¦¬ì•¡íŠ¸

## 4ì¥ - ë¦¬ì•¡íŠ¸ API ì—°ë™

### API ì—°ë™ì˜ ê¸°ë³¸ - 2ï¸âƒ£ axios, useReducerë¡œ API ì—°ë™í•˜ê¸°

> **useStateëŒ€ì‹  useReducer ì‚¬ìš©í•˜ê¸°**

- useReducerì˜ ì¥ì ì€ setState í•¨ìˆ˜ë¥¼ ì—¬ëŸ¬ë²ˆ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë˜ê³ , reducer í•¨ìˆ˜ë¥¼ **ì¬ì‚¬ìš©** í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.
- ê´€ë¦¬í•  ìƒíƒœê°’ì´ ë§ì•„ì§€ê³  ë°˜ë³µë˜ëŠ” ë¡œì§ì´ ë§ì´ ê²¹ì¹  ìˆ˜ë¡ useReducerë¥¼ ì“°ëŠ”ê²ƒì´ ìœ ë¦¬í•  ìˆ˜ ìˆë‹¤.
  <br>

**[ ê¸°ì¡´ ì½”ë“œ ]**

```javascript
import React, { useState, useEffect } from "react";
import axios from "axios";

function Users() {
  // APIì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°(users), í˜„ì¬ ìƒíƒœ(loading), ì—ëŸ¬ ë°œìƒ ì—¬ë¶€ ë° ì—ëŸ¬ ê°ì²´(error)
  const [users, setUsers] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  // axiosë¥¼ í†µí•´ APIì—ì„œ usersë¥¼ ì§ˆì˜í•´ì„œ ê°€ì ¸ì˜¤ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜
  const fetchUsers = async () => {
    try {
      setUsers(null);
      setError(null);
      setLoading(true);
      const res = await axios.get("https://jsonplaceholder.typicode.com/users");
      setUsers(res.data);
    } catch (e) {
      setError(e);
      console.log(e.message);
    }
    setLoading(false);
  };
  // í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ ë  ë•Œ, fetchUsers()ê°€ í˜¸ì¶œëœë‹¤.
  useEffect(() => {
    fetchUsers();
  }, []);
  // ê° ìƒíƒœë§ˆë‹¤, ë‹¤ë¥´ê²Œ ë Œë”ë§ì„ í•´ì¤€ë‹¤.
  if (loading) return <div>ë¡œë”© ì¤‘...</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>;
  // ì˜ˆì™¸ì²˜ë¦¬
  if (!users) return null;
  return (
    <>
      <ul>
        {users.map((user) => (
          <li key={user.id}>
            {user.username} ({user.name})
          </li>
        ))}
      </ul>
      <button onClick={fetchUsers}>Update</button>
    </>
  );
}

export default Users;
```

**[ useReducerë¥¼ ì‚¬ìš©í•œ ì½”ë“œ ]**

```javascript
import React, { useEffect, useReducer } from "react";
import axios from "axios";

// action.typeì— ë”°ë¼ stateê°’ì„ ê´€ë¦¬í•  reducer í•¨ìˆ˜
function reducer(state, action) {
  switch (action.type) {
    case "LOADING":
      return {
        loading: true,
        data: null,
        error: null,
      };
    case "SUCCESS":
      return {
        loading: false,
        data: action.data,
        error: null,
      };
    case "ERROR":
      return {
        loading: false,
        data: null,
        error: action.error,
      };
    default:
      throw new Error(`Unhandled action type: ${action.type}`);
  }
}

function Users() {
  const [state, dispatch] = useReducer(reducer, {
    loading: false,
    data: null,
    error: null,
  });

  const fetchUsers = async () => {
    // typeëª…ì‹œë¡œ ì–´ë–¤ ìƒíƒœë¥¼ í˜¸ì¶œí•  ê²ƒì¸ì§€ë¥¼ ëª…í™•íˆ ì•Œ ìˆ˜ ìˆìŒ
    dispatch({ type: "LOADING" });
    try {
      const res = await axios.get("https://jsonplaceholder.typicode.com/users");
      dispatch({ type: "SUCCESS", data: res.data });
    } catch (e) {
      dispatch({ type: "ERROR", error: e });
    }
  };
  // í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ ë  ë•Œ, fetchUsers()ê°€ í˜¸ì¶œëœë‹¤.
  useEffect(() => {
    fetchUsers();
  }, []);

  // state.data ë¥¼ users í‚¤ì›Œë“œë¡œ ì¡°íšŒ
  const { loading, data: users, error } = state;

  if (loading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</div>;
  if (!users) return null;
  return (
    <>
      <ul>
        {users.map((user) => (
          <li key={user.id}>
            {user.username} ({user.name})
          </li>
        ))}
      </ul>
      <button onClick={fetchUsers}>ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </>
  );
}

export default Users;
```

## Reference

- ë²¨ë¡œí¼íŠ¸ì™€ í•¨ê»˜í•˜ëŠ” ëª¨ë˜ ë¦¬ì•¡íŠ¸ - 4ì¥ <https://react.vlpt.us/integrate-api/02-useReducer.html> <br>

[ğŸ‘ˆğŸ»PREV](https://github.com/ss-won/veloport-react/blob/master/Ch4/1.md) |
[NEXTğŸ‘‰ğŸ»](https://github.com/ss-won/veloport-react/blob/master/Ch4/3.md) <br>
[ëŒì•„ê°€ê¸°](https://github.com/ss-won/veloport-react)
