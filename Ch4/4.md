# veloportì™€ í•¨ê»˜í•˜ëŠ” ëª¨ë˜ ë¦¬ì•¡íŠ¸

## 4ì¥ - ë¦¬ì•¡íŠ¸ API ì—°ë™

### API ìƒíƒœê°’ ê´€ë¦¬í•˜ê¸° - 2ï¸âƒ£ react-async ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©í•˜ê¸°

> **react-async**

- React Async ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ”,

**`React Async is a utility belt for declarative promise resolution and data fetching. It makes it easy to handle asynchronous UI states, without assumptions about the shape of your data or the type of request. React Async consists of a React component and several hooks. You can use it with fetch, Axios or other data fetching libraries, even GraphQL.`**

ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•˜ê³  ìˆê³ , ê°„ë‹¨íˆ ë§í•´ì„œ **`UI ìƒíƒœ ê´€ë¦¬ ë¡œì§`ìœ¼ë¡œ ì„ ì–¸í˜•(ë¬´ì—‡ì„ í• ì§€ë¥¼ ë‚˜ì—´í•˜ëŠ” ë°©ì‹) Promiseë¥¼ ë‹¤ë£¨ê±°ë‚˜ Dataë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‘ì—… ë“±ì˜ `ë¹„ë™ê¸° ì‘ì—…`ì„ ì‚¬ìš©í•  ë•Œ ê´€ë ¨ ë¡œì§ì„ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” ì“°ì´ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.** React ì»´í¬ë„ŒíŠ¸ì™€ ì—¬ëŸ¬ Custom Hookì„ ì œê³µí•˜ê³  ìˆë‹¤. ìœ„ì˜ ì„¤ëª…ì„ ë³´ë‹ˆ ìµœê·¼ ë§ì´ ì“°ì´ëŠ” GraphQLë„ ì§€ì›í•˜ëŠ”ë“¯ í•˜ë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [React Async Documentation](https://docs.react-async.com/getting-started/usage)ì„ ì°¸ì¡°í•˜ì.

- í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì¥ì ì€ Custom Hookì„ ì¼ì¼ì´ êµ¬í˜„í•  í•„ìš”ì—†ì´ í•„ìš”í•œ optionì„ ì§€ì •í•´ì„œ ë¹„ë™ê¸° ìƒíƒœ ê´€ë¦¬ ë¡œì§ì„ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.
- React Asyncì˜ useAsync Hookì—ëŠ” Configuration optionsê³¼ return ë°›ì„ ìˆ˜ ìˆëŠ” State propertiesë¥¼ ì œê³µí•˜ê³  ìˆëŠ”ë°, í•´ë‹¹ ë‚´ìš© ì¤‘ ëª‡ê°€ì§€ë¥¼ í•´ì„í•´ì„œ ì •ë¦¬í•´ë³´ê² ë‹¤. ë” ìì„¸í•œ ì˜ˆì‹œëŠ” ë§ˆì°¬ê°€ì§€ë¡œ [React Async Documentation](https://docs.react-async.com/getting-started/usage)ì„ ì°¸ì¡°í•˜ì.

### Configuration options

- `promiseFn` ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ í•¨ìˆ˜(Promise ë°˜í™˜)
- `deferFn` runì´ë¼ëŠ” state í•¨ìˆ˜ë¥¼ í†µí•´ì„œë§Œ í˜¸ì¶œë˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ í•¨ìˆ˜(Promise ë°˜í™˜)
- `watch` ì—…ë°ì´íŠ¸ ë ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì¬í˜¸ì¶œì‹œì¼œ ë¦¬ë¡œë“œí•˜ëŠ”ë° ê¸°ì¤€ì´ ë˜ëŠ” ê°’(react Hookì—ì„œ dependency ê°œë…)
- `watchFn` í•¨ìˆ˜ê°€ truthy ê°’ì„ ë°˜í™˜í• ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì¬í˜¸ì¶œì‹œì¼œ ë¦¬ë¡œë“œí•˜ëŠ”ë° ê¸°ì¤€ì´ ë  í•¨ìˆ˜
- `initialValue` ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ì‹œ ì´ˆê¸°ë°ì´í„° ë˜ëŠ” ì—ëŸ¬ ê°ì²´ë¡œ ì œê³µë˜ëŠ” ê°’
- `onResolve` Promiseê°€ resolve ë  ë•Œ, í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜
- `onReject` Promiseê°€ reject ë  ë•Œ, í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜
- `onCancel` Promiseê°€ cancel ë  ë•Œ, í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜
- `reducer` ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì˜ ì—…ë°ì´íŠ¸ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ìƒíƒœ ê´€ë¦¬ reducer í•¨ìˆ˜

### State properties

- `data` ë§ˆì§€ë§‰ìœ¼ë¡œ resolvedëœ promise ë°˜í™˜ê°’ìœ¼ë¡œ ìƒˆë¡œìš´ error ê°ì²´ê°€ ì „ë‹¬ë ë•Œê¹Œì§€ ìœ ì§€ëœë‹¤.
- `error` promiseê°€ rejectëœ ì´ìœ ì— ëŒ€í•œ ë‚´ìš©ìœ¼ë¡œ ìƒˆë¡œìš´ dataê°€ ì „ë‹¬ë˜ë©´ ì´ˆê¸°í™”ëœë‹¤.
- `value` data ë˜ëŠ” errorê°’ìœ¼ë¡œ, ë‘˜ ì¤‘ ì–´ë–¤ ê°’ì´ë¼ë„ ìµœì‹  ìƒíƒœë¥¼ ìœ ì§€í•œë‹¤.
- `initialValue` optionì˜ initialValueë¥¼ í†µí•´ ì œê³µë˜ëŠ” data ë˜ëŠ” error ê°’
- `startedAt` í˜„ì¬ ë˜ëŠ” ë§ˆì§€ë§‰ìœ¼ë¡œ promiseê°€ ì‹œì‘ëœ ì‹œì 
- `finishedAt` ë§ˆì§€ë§‰ìœ¼ë¡œ promiseê°€ fulfilled ë˜ëŠ” rejectedëœ ì‹œì 
- `status` promise ìƒíƒœê°’(initial, pending, fulfilled, rejected ì¤‘ í•˜ë‚˜)
- `counter` promiseê°€ ì‹œì‘ëœ íšŸìˆ˜
- `run` optionì˜ deferFnì˜ í˜¸ì¶œì—¬ë¶€ë¥¼ ê²°ì •í•˜ëŠ” í•¨ìˆ˜

> **react-asyncë¡œ ìƒíƒœ ë¡œì§ ê´€ë¦¬í•˜ê¸°**

- í•´ë‹¹ ì˜ˆì œëŠ”, ì•ì„œ ì‘ì„±í–ˆë˜ User, Users ì»´í¬ë„ŒíŠ¸ì˜ ë¹„ë™ê¸° ì²˜ë¦¬ ë¡œì§ì„ react-asyncë¥¼ í†µí•´ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ë‹¤.

```javascript
// src/User.js
import React from "react";
import axios from "axios";
import { useAsync } from "react-async";

async function getUser({ id }) {
  const response = await axios.get(
    `https://jsonplaceholder.typicode.com/users/${id}`
  );
  return response.data;
}

function User({ id }) {
  // ë‚´ë¶€ optionsê°’ì„ ê°ì²´ë¡œ ì „ë‹¬í•´ useAsyncë¥¼ í†µí•œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•˜ê³ 
  // ë°˜í™˜ëœ state ê°’ì„ ê°ì²´ ë¹„êµ¬ì¡°í™” í• ë‹¹ìœ¼ë¡œ ê°€ì ¸ì˜¨ë‹¤.
  const { data: user, error, isLoading } = useAsync({
    // (íŠ¹ì • í˜¸ì¶œ ì—†ì´) ìë™ìœ¼ë¡œ í˜¸ì¶œë  ë¹„ë™ê¸° ì²˜ë¦¬ í•¨ìˆ˜(Promise ë°˜í™˜)
    promiseFn: getUser,
    // getUser ì¸ìë¡œ ì „ë‹¬ë  íŒŒë¼ë¯¸í„° ê°’ì„ optionê³¼ í•¨ê»˜ ë„£ì–´ì¤€ë‹¤.
    id,
    // ì—…ë°ì´íŠ¸ ë ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì¬í˜¸ì¶œì‹œì¼œ ë¦¬ë¡œë“œí•˜ëŠ”ë° ê¸°ì¤€ì´ ë˜ëŠ” ê°’
    // id ê°’ì´ ì—…ë°ì´íŠ¸ ë ë•Œë§ˆë‹¤ promiseFn í•¨ìˆ˜ê°€ ì¬í˜¸ì¶œë˜ì–´ ë¦¬ë Œë”ë§ëœë‹¤.
    watch: id,
  });

  if (isLoading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</div>;
  if (!user) return null;

  return (
    <div>
      <h2>{user.username}</h2>
      <p>
        <b>Email:</b> {user.email}
      </p>
    </div>
  );
}

export default User;
```

```javascript
import React, { useState } from "react";
import axios from "axios";
import { useAsync } from "react-async";
import User from "./User";

async function getUsers() {
  const response = await axios.get(
    "https://jsonplaceholder.typicode.com/users"
  );
  return response.data;
}

function Users() {
  const [userId, setUserId] = useState(null);
  // useAsyncë¥¼ ì´ìš©í•œ stateê°’ ê´€ë¦¬
  const { data: users, error, isLoading, run } = useAsync({
    // runì´ë¼ëŠ” stateí•¨ìˆ˜ë¥¼ í†µí•´ì„œë§Œ í˜¸ì¶œë˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ í•¨ìˆ˜
    deferFn: getUsers,
  });

  if (isLoading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</div>;
  /* 
      ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ, run state í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ 
      deferFnìœ¼ë¡œ ì „ë‹¬ëœ ë¹„ë™ê¸° ì²˜ë¦¬ ë¡œì§ì„ ì‹¤í–‰ì‹œí‚¨ë‹¤.
      ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, mountë ë•Œ í˜¸ì¶œë˜ì§€ ì•Šê³  buttonì„ ëˆ„ë¥¸ ì´í›„ì— í˜¸ì¶œëœë‹¤.
  */
  if (!users) return <button onClick={run}>ë¶ˆëŸ¬ì˜¤ê¸°</button>;

  return (
    <div>
      <ul>
        {users.map((user) => (
          <li
            key={user.id}
            onClick={() => setUserId(user.id)}
            style={{ cursor: "pointer" }}
          >
            {user.username} ({user.name})
          </li>
        ))}
      </ul>
      {/* 
      ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ, run state í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ 
      deferFnìœ¼ë¡œ ì „ë‹¬ëœ ë¹„ë™ê¸° ì²˜ë¦¬ ë¡œì§ì„ ì‹¤í–‰ì‹œí‚¨ë‹¤.
      */}
      <button onClick={run}>ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      {userId && <User id={userId} />}
    </div>
  );
}

export default Users;
```

## Reference

- ë²¨ë¡œí¼íŠ¸ì™€ í•¨ê»˜í•˜ëŠ” ëª¨ë˜ ë¦¬ì•¡íŠ¸ - 4ì¥ <https://react.vlpt.us/integrate-api/04-react-async.html>
  <br>

[ğŸ‘ˆğŸ»PREV](https://github.com/ss-won/veloport-react/blob/master/Ch4/3.md) |
[NEXTğŸ‘‰ğŸ»](https://github.com/ss-won/veloport-react/blob/master/Ch4/5.md) <br>
[ëŒì•„ê°€ê¸°](https://github.com/ss-won/veloport-react)
