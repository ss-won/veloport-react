# veloportì™€ í•¨ê»˜í•˜ëŠ” ëª¨ë˜ ë¦¬ì•¡íŠ¸

## 1ì¥ - ë¦¬ì•¡íŠ¸ ì…ë¬¸

### Context API ì‚¬ìš©í•˜ê¸°

> **React.createContext**

- Context ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
- Contextë¥¼ êµ¬ë…í•˜ê³  ìˆëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í• ë•Œ, íŠ¸ë¦¬ ìƒìœ„ì—ì„œ ê°€ì¥ ê°€ê¹Œì´ ìˆëŠ” Context.Providerë¡œ ë¶€í„° í˜„ì¬ valueê°’ì„ ì½ëŠ”ë‹¤.
- `defaultValue`ê°’ì€ ì ì ˆí•œ Context.Providerë¥¼ ì°¾ì§€ ëª»í–ˆì„ ë•Œì—ë§Œ ì“°ì¸ë‹¤. <br>
  ğŸ‘‰ğŸ»Providerë¥¼ í†µí•´ `undefined`, `null` ê°’ì„ ë³´ë‚´ë”ë¼ë„ **defaultValueë¥¼ ì½ì§€ ì•ŠëŠ” ê²ƒì— ì£¼ì˜** í•´ì•¼ í•œë‹¤.

```javascript
const MyContext = React.createContext(defaultValue);
```

> **Context.Provider**

- Context ê°ì²´ì— í¬í•¨ëœ React ì»´í¬ë„ŒíŠ¸ì´ë‹¤.
- contextë¥¼ êµ¬ë…í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì— contextì˜ ë³€í™”ë¥¼ ì•Œë ¤ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.

```javascript
<MyContext.Provider value={/* ì–´ë–¤ ê°’ */}>
```

- `value` propsë¥¼ ë°›ì•„, í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬í•œë‹¤.
- Provider í•˜ìœ„ì— Providerë¥¼ ë‘ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‚˜, ì´ë•Œ **í•˜ìœ„ Provider ê°’ì´ ìš°ì„ ì‹œ** ëœë‹¤.
- Provider í•˜ìœ„ì—ì„œ contextë¥¼ êµ¬ë…í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸(consumer)ëŠ” Providerì˜ value propê°€ ë°”ë€”ë•Œë§ˆë‹¤ ë‹¤ì‹œ ë Œë”ë§ ëœë‹¤.
- Providerì˜ í•˜ìœ„ consumerì—ëŠ” [SCU(Should Components Update) ë©”ì†Œë“œ](https://ko.reactjs.org/docs/optimizing-performance.html#shouldcomponentupdate-in-action)ê°€ ì ìš©ë˜ì§€ ì•Šì•„, ìƒìœ„ ì»´í¬ë„ŒíŠ¸ê°€ ì—…ë°ì´íŠ¸ë¥¼ ê±´ë„ˆ ë›°ë”ë¼ë„ consumerê°€ ì—…ë°ì´íŠ¸ ëœë‹¤.
- `value`ë¥¼ ê°ì²´ í˜•íƒœë¡œ ì „ë‹¬í•  ê²½ìš°, ë¶ˆí•„ìš”í•œ ë Œë”ë§ì´ ì¦ê°€í•  ìˆ˜ ìˆë‹¤. ğŸ‘‰ğŸ» [ì°¸ê³ ](https://ko.reactjs.org/docs/context.html#caveats)

> **useContext**

- ì»´í¬ë„ŒíŠ¸ì˜ ì¤‘ì²©ì—†ì´ React contextë¥¼ êµ¬ë…í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” Hookì´ë‹¤.

```javascript
const value = useContext(MyContext);
```

- `context ê°ì²´`(React.createContextì—ì„œ ë°˜í™˜ëœ ê°’)ë¥¼ ë°›ì•„ contextì˜ **í˜„ì¬ê°’ì„ ë°˜í™˜** í•œë‹¤.
- ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ <MyContext.Provider></MyContext.Provider>ê°€ ê°±ì‹ ë˜ë©´ ì´ Hookì€ ê·¸ MyContext providerì—ê²Œ ì „ë‹¬ëœ ê°€ì¥ **ìµœì‹ ì˜ context valueë¥¼ ì‚¬ìš©í•˜ì—¬ ë Œë”ëŸ¬ë¥¼ íŠ¸ë¦¬ê±°** í•œë‹¤. ê·¸ë¦¬ê³  **useContextë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê°ì²´ì—ì„œë¶€í„° ë¦¬ë Œë”ë§** ëœë‹¤.
- `useContext`ë¥¼ í˜¸ì¶œí•œ ì»´í¬ë„ŒíŠ¸ëŠ” **context ê°’ì´ ë³€ê²½ë˜ë©´ í•­ìƒ ë¦¬ë Œë”ë§** ëœë‹¤.

<br>
<hr>

> **EX1** <br>
> ì•„ë˜ ì˜ˆì œëŠ” ContextSample -> GrandParent -> Parent -> Child ì»´í¬ë„ŒíŠ¸ë¡œ state ê°’ì„ valueë¡œ ì „ë‹¬í•˜ê³  ìˆë‹¤. <br>
> ë§Œì•½ ë²„íŠ¼ì„ ëˆŒëŸ¬ valueê°€ ì°¸ì¡°í•˜ëŠ” state ê°’ì´ ë³€í•˜ë©´, í•´ë‹¹ Providerì˜ í•˜ìœ„ consumerì—ì„œ í•´ë‹¹ contextë¥¼ ì°¸ì¡°í•˜ê³  ìˆëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì´ ëª¨ë‘ ë¦¬ë Œë”ë§ ëœë‹¤.

```javascript
import React, { createContext, useContext, useState } from "react";

const MyContext = createContext("defaultValue");

function Child() {
  const text = useContext(MyContext);
  return <div>ì•ˆë…•í•˜ì„¸ìš”? {text}</div>;
}

function Parent({ text }) {
  return <Child />;
}

function GrandParent({ text }) {
  return <Parent />;
}

function ContextSample() {
  const [value, setValue] = useState(true);
  return (
    <MyContext.Provider value={value ? "GOOD" : "BAD"}>
      <GrandParent />
      <button onClick={() => setValue(!value)}>CLICK ME</button>
    </MyContext.Provider>
  );
}

export default ContextSample;
```

<br>

> **EX2** <br>
> ì•„ë˜ ì˜ˆì œëŠ” ë‹¨ìˆœíˆ onRemove, onToggle ê°ì²´ë§Œë“¤ ì „ë‹¬í•˜ê³  ìˆëŠ” UserList, Userì—ì„œ,
> dispatch contextë¥¼ ì°¸ì¡°í•˜ê²Œ í•˜ì—¬ Userì—ì„œ ì§ì ‘ ë©”ì†Œë“œë¥¼ êµ¬í˜„í•œ ì˜ˆì œì´ë‹¤.

```javascript
// Context API ì‚¬ìš©ì „
// src/UserList.js
function User({ user, onRemove, onToggle }) {
  const { username, email, id, active } = user;
  return (
    <div>
      <b
        style={{
          color: active ? "green" : "black",
          cursor: "pointer",
        }}
        onClick={() => {
          onToggle(id);
        }}
      >
        {username}
      </b>
      <span>({email})</span>
      <button
        onClick={() => {
          onRemove(id);
        }}
      >
        ì‚­ì œ
      </button>
    </div>
  );
}

function UserList({ users, onRemove, onToggle }) {
  return (
    <div>
      {users.map((u) => (
        <User user={u} key={u.id} onRemove={onRemove} onToggle={onToggle} />
      ))}
    </div>
  );
}
export default UserList;
```

```javascript
// Context API ì ìš© í›„
// src/UserList.js
import React, { useContext } from "react";
import { UserDispatch } from "./App";

const User = React.memo(function User({ user }) {
  const { username, email, id, active } = user;
  const dispatch = useContext(UserDispatch);
  return (
    <div>
      <b
        style={{
          color: active ? "green" : "black",
          cursor: "pointer",
        }}
        onClick={() =>
          dispatch({
            type: "TOGGLE_USER",
            id,
          })
        }
      >
        {username}
      </b>
      <span>({email})</span>
      <button
        onClick={() =>
          dispatch({
            type: "REMOVE_USER",
            id,
          })
        }
      >
        ì‚­ì œ
      </button>
    </div>
  );
});

function UserList({ users }) {
  return (
    <div>
      {users.map((user) => (
        <User user={user} key={user.id} />
      ))}
    </div>
  );
}
export default React.memo(
  UserList,
  (prevProps, nextProps) => prevProps.users === nextProps.users
);
```

```javascript
// src/App.js
...
function reducer(state, action) {
  switch(action.type){
    case 'CREATE_USER':
     return {
       users: [...state.users, action.user]
     }
    case 'TOGGLE_USER':
      return {
        ...state,
        users: state.users.map(user => (user.id === action.id)
        ? {...user, active: !user.active}
        : user
        )
      }
    case 'REMOVE_USER':
      return {
        ...state,
        users: state.users.filter(user => user.id !== action.id)
      }
    default:
      throw new Error('Unhandled Error');
  }
}
// context ê°ì²´ ìƒì„±
export const UserDispatch = createContext(null);

function App() {
  const [state, dispatch] = useReducer(reducer, initialState);
  const { users } = state;
  const count = useMemo(() => CountActiveUsers(users), [users]);
  return (
    // dispatchì˜ ê°’ì´ ë³€í• ë•Œë§ˆë‹¤ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ ì¤‘
    // UserDispatchë¥¼ ì°¸ì¡°í•˜ëŠ” ì§€ì ë¶€í„° ë¦¬ë Œë”ë§ëœë‹¤.
    <UserDispatch.Provider value={dispatch}>
      <CreateUser />
      <UserList users={users} />
      <div>í™œì„± ì‚¬ìš©ì ìˆ˜ : {count}</div>
    </UserDispatch.Provider>
  );
}

export default App;
```

## Reference

<https://ko.reactjs.org/docs/hooks-reference.html#usecontext>
<br>

[ğŸ‘ˆğŸ»PREV](https://github.com/ss-won/veloport-react/blob/master/Ch1/13.md) |
[NEXTğŸ‘‰ğŸ»](https://github.com/ss-won/veloport-react/blob/master/Ch1/15.md) <br>
[ëŒì•„ê°€ê¸°](https://github.com/ss-won/veloport-react)
