# veloportì™€ í•¨ê»˜í•˜ëŠ” ëª¨ë˜ ë¦¬ì•¡íŠ¸
## 1ì¥ - ë¦¬ì•¡íŠ¸ ì…ë¬¸
### Classí˜• ì»´í¬ë„ŒíŠ¸ ì‘ì„±í•˜ê¸°
> __Immer ì‚¬ìš©í•´ì„œ ë¶ˆë³€ì„± ê´€ë¦¬í•˜ê¸°__
- ë¦¬ì•¡íŠ¸ì—ì„œ ë°°ì—´, ê°ì²´ë¥¼ ì—…ë°ì´íŠ¸ í• ë•ŒëŠ” ë¶ˆë³€ì„±ì„ ì§€ì¼œì£¼ì–´ì•¼ í•œë‹¤.
- ë³´í†µ ë°°ì—´ì˜ ë‚´ì¥í•¨ìˆ˜ì™€ ì „ê°œêµ¬ë¬¸(spread syntax)ì„ ì´ìš©í•˜ì—¬ ë¶ˆë³€ì„±ì„ ì§€í‚¤ë©´ì„œ ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.
- ê·¸ëŸ¬ë‚˜, ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì˜ ê°ì²´ ê°’ì´ ë³µì¡í•´ì§€ëŠ” ê²½ìš° í•´ë‹¹ ê¸°ëŠ¥ë§Œìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° í˜ë“¤ì–´ì§€ëŠ” ê²½ìš°ê°€ ë°œìƒí•œë‹¤. ì´ëŸ¬í•œ ê²½ìš°ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `Immer`, `immutability-helper`ë“±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° ë³¸ ì •ë¦¬ê¸€ì—ì„œëŠ” Immerì— ëŒ€í•´ì„œë§Œ ë‹¤ë£¬ë‹¤.
- Proxy ì—”ì§„ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, react-nativeì—ì„œëŠ” ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì„±ëŠ¥ì ìœ¼ë¡œ ë´¤ì„ë•Œ, ê¸°ë³¸ JavaScript êµ¬ë¬¸ë§Œìœ¼ë¡œ êµ¬í˜„í•œ ê²ƒë³´ë‹¤ëŠ” ì¡°ê¸ˆ ë–¨ì–´ì§„ë‹¤.

> __ê¸°ë³¸ ì‚¬ìš© ë°©ë²•__
```bash
# immer install
yarn install immer
```
```javascript
// Quick Example
// í†µìƒì ìœ¼ë¡œ produceë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¨ë‹¤.
import produce from "immer"

const baseState = [
    {
        todo: "Learn typescript",
        done: true
    },
    {
        todo: "Try immer",
        done: false
    }
]

// baseState: í˜„ì¬ State ê°ì²´, draftState: ë³€í™”ì‹œí‚¬ State ê°ì²´
// draftStateì— ë³€í™”ë¥¼ ì¤€ ë‚´ìš©ì´ ë¶ˆë³€ê°’ì„ í•´ì¹˜ì§€ ì•Šê³  Stateì— ìƒˆë¡œìš´ ê°ì²´ë¥¼ ì „ë‹¬ì‹œí‚¨ë‹¤.
const nextState = produce(baseState, draftState => {
    draftState.push({todo: "Tweet about it"})
    draftState[1].done = true
})
```
<br>

> __í™œìš© 1 : reducerì— immer ë¼ì´ë¸ŒëŸ¬ë¦¬ ì ìš©í•˜ê¸°__
useReducerì—ì„œ ì‚¬ìš©í•  reducer í•¨ìˆ˜ ì‘ì„±ì—ì„œ, immer ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ state ê°’ì„ ì—…ë°ì´íŠ¸ í•´ì¤€ ì˜ˆì œì´ë‹¤.<br>
ì£¼ì„ìœ¼ë¡œ ì²˜ë¦¬ ëœ ë¶€ë¶„ì€ JavaScriptë§Œì„ ì‚¬ìš©í•´ì„œ ì‘ì„±í•  ê²½ìš°ì˜ ì½”ë“œì´ë‹¤.
```javascript
const initialState = {
  users: [
    {
      id: 1,
      username: "wish",
      email: "swj960515@gmail.com",
      active: true,
    },
    {
      id: 2,
      username: "tester",
      email: "example@gmail.com",
      active: false,
    },
    {
      id: 3,
      username: "tester2",
      email: "example2@gmail.com",
      active: false,
    },
  ],
};

function reducer(state, action) {
  switch(action.type){
    case 'CREATE_USER':
     return produce(state, draft => {
       draft.users.push(action.user);
     })
     /*
     {
       users: [...state.users, action.user]
     }
     */
    case 'TOGGLE_USER':
      return produce(state, draft => {
        const user = draft.users.find(u=>u.id === action.id);
        user.active = !user.active;
      })
      /*
      {
        ...state,
        users: state.users.map(user => (user.id === action.id) 
        ? {...user, active: !user.active} 
        : user
        )
      }
      */
    case 'REMOVE_USER':
      return produce(state, draft => {
        const idx = draft.users.findIndex(u=>u.id === action.id);
        draft.users.splice(idx, 1);
      })
      /*
      {
        ...state,
        users: state.users.filter(user => user.id !== action.id)
      }
      */
    default:
      throw new Error('Unhandled Error');
  }
}
```
<br>

> __í™œìš© 2 : immerì˜ í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ ì´ìš©í•˜ê¸°__
ì•„ë˜ëŠ” React.setState í•¨ìˆ˜ ë‚´ë¶€ì˜ state ê°’ ì—…ë°ì´íŠ¸ ì‹œ immerë¥¼ í™œìš©í•˜ëŠ” ì˜ˆì œì´ë‹¤.<br>
immerê°€ ë°˜í™˜í•˜ëŠ” ê²ƒì´ state ê°ì²´ ìì²´ê°€ ì•„ë‹Œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì—, ê¸°ì¡´ì˜ í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ ì„ ì–¸ì„ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤.
```javascript
/**
 * Classic React.setState with a deep merge
 */
onBirthDayClick1 = () => {
    this.setState(prevState => ({
        user: {
            ...prevState.user,
            age: prevState.user.age + 1
        }
    }))
}

/**
 * ...But, since setState accepts functions,
 * we can just create a curried producer and further simplify!
 */
onBirthDayClick2 = () => {
    this.setState(
        produce(draft => {
            draft.user.age += 1
        })
    )
}
```

## Reference
<https://react.vlpt.us/basic/23-immer.html>
<https://immerjs.github.io/immer/docs/introduction>
<https://ko.reactjs.org/docs/optimizing-performance.html#the-power-of-not-mutating-data>
<br>

[ğŸ‘ˆğŸ»PREV](https://github.com/ss-won/veloport-react/blob/master/Ch1/md/14.md) |
[NEXTğŸ‘‰ğŸ»](https://github.com/ss-won/veloport-react/blob/master/Ch1/md/16.md) <br>
[ëŒì•„ê°€ê¸°](https://github.com/ss-won/veloport-react)