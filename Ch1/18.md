# veloportì™€ í•¨ê»˜í•˜ëŠ” ëª¨ë˜ ë¦¬ì•¡íŠ¸

## 1ì¥ - ë¦¬ì•¡íŠ¸ ì…ë¬¸

### componentDidCatchë¡œ Error Handling ë° Monitoring í•˜ê¸°

> **Error Handlingê³¼ Monitoringì´ í•„ìš”í•œ ì´ìœ **

- Error Handlingì„ ìœ„í•œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•´ì£¼ì§€ ì•Šìœ¼ë©´, ì—ëŸ¬í™”ë©´ì´ ì†¡ì¶œë˜ì–´ ì‚¬ìš©ìì—ê²Œ ë¶ˆí•„ìš”í•œ ì—ëŸ¬ ì •ë³´ë¥¼ ì œê³µí•œë‹¤.
- Error Monitoringì€ ì˜ˆì™¸ì²˜ë¦¬ì— ì˜í•œ ì—ëŸ¬ìƒí™©ì„ í†µí•´ ì–´ë–¤ ê³³ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ì§€ë¥¼ ë¡œê·¸ë¥¼ í†µí•´ í™•ì¸í•´ì„œ, ê°œë°œìê°€ ê°œì„ í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

<br>

ì•„ë˜ëŠ” userë¼ëŠ” propsë¥¼ ì¸ìë¡œ ë°›ëŠ” User ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§ í• ë•Œ, <br>
í•´ë‹¹ propsë¥¼ ì§€ì •í•´ì£¼ì§€ ì•Šê³ , default ê°’ë„ ì§€ì •í•´ ì£¼ì§€ ì•Šì•„ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ì˜ˆì œì´ë‹¤. <br>

```javascript
// src/User.js
import React from "react";

function User({ user }) {
  // ì‹¤ì œë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ì„¤ê³„í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•´ì£¼ê³ ,
  // propsì˜ defaultê°’ì„ ì„¤ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.
  // ë‹¤ë§Œ, í•´ë‹¹ ì‘ì—…ì„ ë¹ íŠ¸ë ¸ì„ ê²½ìš°ë‚˜ í˜¹ì€ ì˜ˆì™¸ì ì¸ JavaScript ì˜¤ë¥˜ì— ëŒ€í•œ
  // ì˜ˆì™¸ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œ Error Boundaryë¥¼ ì‚¬ìš©í•œë‹¤.
  //if (!user) return null;
  return (
    <div>
      <div>
        <b>ID</b>: {user.id}
      </div>
      <div>
        <b>Username</b>: {user.username}
      </div>
    </div>
  );
}

export default User;
```

```javascript
// src/App.js
import React from "react";
import User from "./User";

function App() {
  const user = {
    id: 1,
    username: "ss-won",
  };
  return (
    <div>
      <User />
      <b>example ğŸ°</b>
    </div>
  );
}

export default App;
```

ì‹¤ì œ ë Œë”ë§ ë˜ëŠ” localhost ì„œë²„ë¡œ ì ‘ì†í•˜ë©´, ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ í™”ë©´ì´ ëœ¨ê³  User ì»´í¬ë„ŒíŠ¸ ë° ì´í›„ Appì—ì„œ ë Œë”ë§ í•˜ëŠ” ë‚´ìš©ë“¤ì€ ë³¼ ìˆ˜ ì—†ë‹¤.
<img src="./example.png" alt="example">
<br><hr>

### ê·¸ë˜ì„œ,

**Reactì—ì„œëŠ” ì»´í¬ë„ŒíŠ¸ í•¨ìˆ˜ ë‚´ë¶€ì˜ JavaScript ì˜¤ë¥˜ë¥¼ ê°ì§€í•˜ê³ , ì˜¤ë¥˜ë¥¼ ê¸°ë¡í•˜ë©°, ì¶©ëŒì´ ë°œìƒí•œ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ë¥¼ ëŒ€ì²´í•˜ëŠ” UIë¥¼ í‘œì‹œí•˜ê¸° ìœ„í•´ `Error Boundary`ë¼ëŠ” ê°œë…ì„ ì‚¬ìš©** í•œë‹¤. <br>
Error BoundaryëŠ” í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ ë‚´ì— `static getDerivedStateFromError()` ë˜ëŠ” `componentDidCatch()`ë¥¼ ì •ì˜í•˜ë©´ ëœë‹¤. ë‘ ìƒëª…ì£¼ê¸°(getDerivedStateFromError or componentDidCatch) ë‚´ì—ì„œ stateë¥¼ ê°±ì‹ í•˜ê²Œ ë˜ë©´ í•˜ìœ„ íŠ¸ë¦¬ ë‚´ì— ì²˜ë¦¬ ë˜ì§€ ì•Šì€ JavaScript ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ê³  ëŒ€ì²´ UIë¥¼ í‘œì‹œí•œë‹¤.
<br><br>

> **static getDerivedStateFromError**

```javascript
static getDerivedStateFromError(error)
```

- í•´ë‹¹ ìƒëª…ì£¼ê¸° ë©”ì†Œë“œëŠ”, ìì‹ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ í˜¸ì¶œëœë‹¤.

```javascript
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    // stateë¥¼ ê°±ì‹ í•˜ì—¬ ë‹¤ìŒ ë Œë”ë§ì—ì„œ ëŒ€ì²´ UIë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
    return { hasError: true };
  }

  render() {
    if (this.state.hasError) {
      // ë³„ë„ë¡œ ì‘ì„±í•œ ëŒ€ì²´ UIë¥¼ ë Œë”ë§í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
      return <h1>Something went wrong.</h1>;
    }

    return this.props.children;
  }
}
```

- ë§¤ê°œë³€ìˆ˜ë¡œ errorë¥¼ ë°›ê³  ê°±ì‹ í•œ stateê°’ì„ ë°˜ë“œì‹œ ë¦¬í„´í•´ì£¼ì–´ì•¼ í•˜ë©°, render ë‹¨ê³„ì—ì„œ ëŒ€ì²´ UIë¥¼ í‘œì‹œí•  ìˆ˜ ìˆë‹¤. <br>

  ğŸ‘‰ğŸ» **ë‹¨, í•´ë‹¹ ìƒëª…ì£¼ê¸° ë©”ì†Œë“œëŠ” render ë‹¨ê³„ì—ì„œ í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì—, side effectë¥¼ ë°œìƒì‹œí‚¤ë©´ ì•ˆëœë‹¤. í•´ë‹¹ ê²½ìš°ì—ëŠ” componentDidCatchë¥¼ ì‚¬ìš©í•œë‹¤.**
  <br><br>

> **componentDidCatch**

```javascript
componentDidCatch(error, info);
```

- í•˜ìœ„ ìì‹ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ í˜¸ì¶œë˜ë©°, ë‘ ê°œì˜ ì¸ìë¥¼ ë°›ëŠ”ë‹¤.
  1. error : ë°œìƒí•œ ì˜¤ë¥˜ ê°ì²´
  2. info : í•´ë‹¹ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ì»´í¬ë„ŒíŠ¸ ì •ë³´ì¸ `componentStack í‚¤`ë¥¼ ê°–ê³  ìˆëŠ” ê°ì²´ <br>
     **ğŸ‘‰ğŸ» ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ì  ê°€ëŠ¥**
- componentDidCatch ë©”ì†Œë“œëŠ” Commit ë‹¨ê³„(DOMì— ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥í•œ)ì—ì„œ ì‘ë™í•˜ê¸° ë•Œë¬¸ì—, getDerivedStateFromErrorì™€ ë‹¬ë¦¬ side effect(ì˜¤ë¥˜ ë¡œê·¸ ê¸°ë¡ ë“±)ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

```javascript
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    // stateë¥¼ ê°±ì‹ í•˜ì—¬ ë‹¤ìŒ ë Œë”ë§ì—ì„œ ëŒ€ì²´ UIë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
    return { hasError: true };
  }

  componentDidCatch(error, info) {
    // Example "componentStack":
    //   in ComponentThatThrows (created by App)
    //   in ErrorBoundary (created by App)
    //   in div (created by App)
    //   in App
    logComponentStackToMyService(info.componentStack);
  }

  render() {
    if (this.state.hasError) {
      // ë³„ë„ë¡œ ì‘ì„±í•œ ëŒ€ì²´ UIë¥¼ ë Œë”ë§í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
      return <h1>Something went wrong.</h1>;
    }

    return this.props.children;
  }
}
```

**ğŸ‘‰ğŸ» ë‹¨, render ë©”ì†Œë“œê°€ ì´ë¯¸ ë°œìƒí•œ í›„ì˜ ìƒíƒœì´ê¸° ë•Œë¬¸ì—, ëŒ€ì²´ UIë¥¼ ì œì–´í•˜ê¸° ì–´ë µë‹¤.(setStateë¥¼ í†µí•´ ê°€ëŠ¥í•˜ì§€ë§Œ release ë²„ì „ì—ì„œëŠ” ë¶ˆê°€ëŠ¥) ì´ ê²½ìš°ì—ëŠ” static getDerivedStateFromErrorë¥¼ ì‚¬ìš©í•´ì„œ ëŒ€ì²´ UIë¥¼ ì œì–´í•´ì¤€ë‹¤.**

ì•„ë˜ ì˜ˆì œëŠ” ìœ„ì˜ ì˜¤ë¥˜ ì˜ˆì œì—ì„œ Error Boundary ì»´í¬ë„ŒíŠ¸ë¥¼ ì ìš©í•´, ì˜¤ë¥˜ ìƒí™©ì— ëŒ€ì²´ UIë¥¼ ì¶œë ¥í•˜ê³  ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ì„ í•´ì£¼ëŠ” ê²ƒì´ë‹¤.

```javascript
// src/ErrorBoundary.js
import React, { Component } from "react";
import * as Sentry from "@sentry/react";

class ErrorBoundary extends Component {
  state = {
    error: false,
  };

  componentDidCatch(error, info) {
    // ì˜¤ë¥˜ ë¡œê·¸ë¥¼ ì¶œë ¥í•œë‹¤.
    console.log("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    console.log({
      error,
      info,
    });
    // ëŒ€ì²´ UI ì¶œë ¥ì„ ìœ„í•´ setStateë¡œ stateë¥¼ ì œì–´í•œë‹¤.
    this.setState({
      error: true,
    });

    // production ëª¨ë“œì—ì„œëŠ” ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ ì¶”ì ì„ ì‚¬ìš©í•˜ë©´ ì•ˆë˜ê¸° ë•Œë¬¸ì—,
    // í•´ë‹¹ ëª¨ë“œì—ì„œëŠ” Sentryë¼ëŠ” ì˜¤ë¥˜ ì¶”ì  í•¸ë“¤ëŸ¬ í”„ë¡œê·¸ë¨ìœ¼ë¡œ í•´ë‹¹ ì˜¤ë¥˜ë¥¼ ë³´ë‚´
    // ì—ëŸ¬ë¥¼ í•¸ë“¤ë§ ë° ëª¨ë‹ˆí„°ë§ í•œë‹¤.
    if (process.env.NODE_ENV === "production") {
      Sentry.captureException(error, { extra: info });
    }
  }

  render() {
    if (this.state.error) {
      return <h1>ì—ëŸ¬ ë°œìƒ!</h1>;
    }
    return this.props.children;
  }
}

export default ErrorBoundary;
```

```javascript
// src/App.js
import React from "react";
import ErrorBoundary from "./ErrorBoundary";
import User from "./User";

function App() {
  const user = {
    id: 1,
    username: "ss-won",
  };
  return (
    <div>
      <ErrorBoundary>
        <User />
      </ErrorBoundary>
      {/* error boundaryì— ì†í•˜ì§€ ì•Šì€ ë¶€ë¶„ì€ ê·¸ëƒ¥ ì¶œë ¥ëœë‹¤ */}
      <b>example ğŸ°</b>
    </div>
  );
}

export default App;
```

## Reference

<https://react.vlpt.us/basic/26-componentDidCatch-and-sentry.html> <br>
<https://ko.reactjs.org/docs/react-component.html#componentdidcatch> <br>
<https://ko.reactjs.org/blog/2017/07/26/error-handling-in-react-16.html>
<br>

[ğŸ‘ˆğŸ»PREV](https://github.com/ss-won/veloport-react/blob/master/Ch1/17.md) |
[NEXTğŸ‘‰ğŸ»](https://github.com/ss-won/veloport-react) <br>
[ëŒì•„ê°€ê¸°](https://github.com/ss-won/veloport-react)
